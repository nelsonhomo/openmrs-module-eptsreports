package org.openmrs.module.eptsreports.reporting.library.queries.mq;

public interface MQCategory13P2QueriesInterface {

  class QUERY {

    public static final String findPatientsWhoArePregnantInclusionPeriodByB1 =
        " SELECT tx_new.patient_id FROM ( "
            + " SELECT patient_id, MIN(art_start_date) art_start_date FROM ( "
            + " SELECT p.patient_id, MIN(value_datetime) art_start_date FROM patient p "
            + " INNER JOIN encounter e ON p.patient_id = e.patient_id "
            + " INNER JOIN obs o ON e.encounter_id = o.encounter_id "
            + " WHERE p.voided = 0 AND e.voided = 0 AND o.voided = 0 AND e.encounter_type = 53 "
            + " AND o.concept_id = 1190 AND o.value_datetime is NOT NULL AND o.value_datetime <= :endInclusionDate AND e.location_id = :location "
            + " GROUP BY p.patient_id "
            + " ) art_start "
            + " GROUP BY patient_id  "
            + " ) tx_new "
            + " INNER JOIN "
            + " ( "
            + " SELECT p.patient_id, cc.encounter_datetime as encounter_datetime "
            + " FROM patient p "
            + " INNER JOIN encounter cc ON p.patient_id = cc.patient_id "
            + " INNER JOIN obs o ON cc.encounter_id = o.encounter_id "
            + " WHERE cc.voided = 0 AND cc.encounter_type = 6  AND cc.location_id = :location "
            + " AND cc.encounter_datetime BETWEEN :startInclusionDate AND :endInclusionDate "
            + " AND o.concept_id = 1982 AND o.value_coded = 1065 AND o.voided = 0 "
            + " ) consulta ON consulta.patient_id = tx_new.patient_id "
            + " WHERE tx_new.art_start_date = consulta.encounter_datetime ";

    public static final String findPatientsWhoArePregnantInFirstConsultationInclusionPeriodByB2 =
        " SELECT tx_new.patient_id "
            + " FROM (SELECT patient_id, MIN(art_start_date) art_start_date FROM  ( "
            + " SELECT p.patient_id, MIN(value_datetime) art_start_date FROM patient p "
            + " INNER JOIN encounter e ON p.patient_id = e.patient_id "
            + " INNER JOIN obs o ON e.encounter_id = o.encounter_id "
            + " WHERE p.voided = 0 AND e.voided = 0 AND o.voided = 0 AND e.encounter_type = 53 "
            + " AND o.concept_id = 1190 AND o.value_datetime is NOT NULL AND o.value_datetime <= :endInclusionDate AND e.location_id = :location "
            + " GROUP BY  p.patient_id "
            + " ) art_start "
            + " GROUP BY patient_id "
            + " ) tx_new "
            + " INNER JOIN "
            + " ( "
            + " SELECT p.patient_id, MIN(e.encounter_datetime) dataConsulta FROM "
            + " patient p "
            + " INNER JOIN encounter e ON e.patient_id = p.patient_id and p.voided = 0 and e.voided = 0 and e.encounter_type = 6 and e.location_id = :location "
            + " INNER JOIN obs o ON o.encounter_id = e.encounter_id and o.voided = 0 and o.concept_id = 1982 and o.value_coded = 1065 and o.location_id = :location "
            + " INNER JOIN person pe ON pe.person_id = e.patient_id and pe.gender = 'F' "
            + " WHERE e.encounter_datetime <= :endInclusionDate "
            + " GROUP by p.patient_id "
            + " ) firstConsult ON firstConsult.patient_id = tx_new.patient_id "
            + " WHERE firstConsult.dataConsulta >= :startInclusionDate AND firstConsult.dataConsulta <= :endInclusionDate "
            + " AND firstConsult.dataConsulta> DATE_ADD(tx_new.art_start_date, INTERVAL 3 MONTH) ";

    public static final String
        findPatientsWhoAreRequestForLaboratoryInvestigationsInclusionPeriodByB3 =
            " select patient_id from ( SELECT tx_new.patient_id, min(fisrtConsultation.encounter_datetime) AS encounter_datetime FROM (  "
                + " SELECT patient_id, MIN(art_start_date) art_start_date FROM ( "
                + " SELECT p.patient_id, MIN(value_datetime) art_start_date FROM patient p "
                + " INNER JOIN encounter e ON p.patient_id = e.patient_id "
                + " INNER JOIN obs o ON e.encounter_id = o.encounter_id "
                + " WHERE p.voided = 0 AND e.voided = 0 AND o.voided = 0 AND e.encounter_type = 53 "
                + " AND o.concept_id = 1190 AND o.value_datetime is NOT NULL AND o.value_datetime <= :endInclusionDate AND e.location_id = :location "
                + " GROUP BY p.patient_id "
                + " ) art_start "
                + " GROUP BY patient_id  "
                + " ) tx_new "
                + " INNER JOIN "
                + " ( "
                + " SELECT p.patient_id, cc.encounter_datetime as encounter_datetime "
                + " FROM patient p "
                + " INNER JOIN encounter cc ON p.patient_id = cc.patient_id "
                + " INNER JOIN obs o ON cc.encounter_id = o.encounter_id "
                + " WHERE 	cc.voided = 0 AND cc.encounter_type = 6  AND cc.location_id = :location "
                + " AND o.concept_id = 23722 AND o.value_coded = 856 AND o.voided = 0 "
                + " ) fisrtConsultation ON fisrtConsultation.patient_id = tx_new.patient_id "
                + " WHERE fisrtConsultation.encounter_datetime BETWEEN date_add(tx_new.art_start_date, INTERVAL 80 DAY) AND date_add(tx_new.art_start_date, INTERVAL 132 DAY) "
                + " GROUP BY tx_new.patient_id "
                + ") result ";

    public static final String
        findPatientsWhoAreRequestForLaboratoryInvestigationAndPregnantInclusionPeriodByB4 =
            " SELECT fisrtConsultation.patient_id "
                + " FROM "
                + " ( "
                + " SELECT p.patient_id, min(cc.encounter_datetime) as encounter_datetime "
                + " FROM patient p "
                + " INNER JOIN encounter cc ON p.patient_id = cc.patient_id "
                + " INNER JOIN obs o ON cc.encounter_id = o.encounter_id "
                + " WHERE cc.voided = 0 AND cc.encounter_type = 6  AND cc.location_id = :location "
                + " AND cc.encounter_datetime BETWEEN :startInclusionDate and :endInclusionDate "
                + " AND o.concept_id = 1982 AND o.value_coded = 1065 AND o.voided = 0 "
                + " GROUP BY p.patient_id "
                + " ) fisrtConsultation "
                + " INNER JOIN encounter e ON e.patient_id = fisrtConsultation.patient_id "
                + " INNER JOIN obs cv ON cv.encounter_id = e.encounter_id "
                + " WHERE cv.concept_id = 23722 AND cv.value_coded = 856 AND cv.voided = 0 "
                + " and e.voided = 0 and e.encounter_type = 6 and e.location_id = :location "
                + " AND fisrtConsultation.encounter_datetime=cv.obs_datetime ";

    public static final String findPatientsWhoHaveCVResultAfter33DaysOfRequestByK =
        " SELECT B3.patient_id FROM "
            + " (SELECT tx_new.patient_id AS patient_id, min(fisrtConsultation.encounter_datetime) AS encounter_datetime, tx_new.art_start_date FROM ( "
            + " SELECT patient_id, MIN(art_start_date) art_start_date FROM ( "
            + " SELECT p.patient_id, MIN(value_datetime) art_start_date FROM patient p "
            + " INNER JOIN encounter e ON p.patient_id = e.patient_id "
            + " INNER JOIN obs o ON e.encounter_id = o.encounter_id "
            + " WHERE p.voided = 0 AND e.voided = 0 AND o.voided = 0 AND e.encounter_type = 53 "
            + " AND o.concept_id = 1190 AND o.value_datetime is NOT NULL AND o.value_datetime <= :endInclusionDate AND e.location_id = :location "
            + " GROUP BY p.patient_id "
            + " ) art_start "
            + " GROUP BY patient_id "
            + " ) tx_new "
            + " INNER JOIN "
            + " ( "
            + " SELECT p.patient_id, cc.encounter_datetime as encounter_datetime "
            + " FROM patient p "
            + " INNER JOIN encounter cc ON p.patient_id = cc.patient_id "
            + " INNER JOIN obs o ON cc.encounter_id = o.encounter_id "
            + " WHERE cc.voided = 0 AND cc.encounter_type = 6  AND cc.location_id = :location "
            + " AND o.concept_id = 23722 AND o.value_coded = 856 AND o.voided = 0 "
            + " ) fisrtConsultation ON fisrtConsultation.patient_id = tx_new.patient_id "
            + " WHERE fisrtConsultation.encounter_datetime BETWEEN date_add(tx_new.art_start_date, INTERVAL 80 DAY) AND date_add(tx_new.art_start_date, INTERVAL 130 DAY) "
            + " GROUP BY tx_new.patient_id "
            + " ) AS B3 "
            + " INNER JOIN encounter e ON e.patient_id = B3.patient_id AND e.voided = 0 AND e.encounter_type = 6 AND e.location_id = :location "
            + " INNER JOIN obs o ON o.encounter_id = e.encounter_id AND o.voided = 0 "
            + " WHERE e.encounter_datetime > B3.encounter_datetime AND e.encounter_datetime <= date_add(B3.encounter_datetime, INTERVAL 33 DAY) "
            + " AND ((o.concept_id = 856 AND o.value_numeric IS NOT NULL) OR (o.concept_id = 1305 AND o.value_coded IS NOT NULL)) ";

    public static final String
        findPatientsWhoHaveCVResultAfeter33DaysOfRequestForPregnantWishRequestedCVByL =
            " SELECT B4.patient_id FROM "
                + " (SELECT fisrtConsultation.patient_id, fisrtConsultation.encounter_datetime "
                + " FROM "
                + " ( "
                + " SELECT 	p.patient_id, min(cc.encounter_datetime) as encounter_datetime "
                + " FROM patient p "
                + " INNER JOIN encounter cc ON p.patient_id = cc.patient_id "
                + " INNER JOIN obs o ON cc.encounter_id = o.encounter_id "
                + " WHERE cc.voided = 0 AND cc.encounter_type = 6  AND cc.location_id = :location "
                + " AND cc.encounter_datetime BETWEEN :startInclusionDate AND :endInclusionDate "
                + " AND o.concept_id = 1982 AND o.value_coded = 1065 AND o.voided = 0 "
                + " GROUP BY p.patient_id "
                + " ) fisrtConsultation "
                + " INNER JOIN obs cv ON cv.person_id = fisrtConsultation.patient_id "
                + " WHERE cv.concept_id = 23722 AND cv.value_coded = 856 AND cv.voided = 0 "
                + " ) AS B4 "
                + " INNER JOIN encounter e ON e.patient_id = B4.patient_id AND e.voided = 0 AND e.encounter_type = 6 AND e.location_id = :location "
                + " INNER JOIN obs o ON o.encounter_id = e.encounter_id AND o.voided = 0 "
                + " WHERE e.encounter_datetime > B4.encounter_datetime AND e.encounter_datetime <= date_add(B4.encounter_datetime, INTERVAL 33 DAY) "
                + " AND ((o.concept_id = 856 AND o.value_numeric IS NOT NULL) OR (o.concept_id = 1305 AND o.value_coded IS NOT NULL)) ";

    public static final String findAllPatientsWhoHaveCVResultAfter33DaysOfStarrDateByM =
        " SELECT B3.patient_id FROM "
            + " (SELECT tx_new.patient_id AS patient_id, min(fisrtConsultation.encounter_datetime) AS encounter_datetime, tx_new.art_start_date FROM ( "
            + " SELECT patient_id, MIN(art_start_date) art_start_date FROM ( "
            + " SELECT p.patient_id, MIN(value_datetime) art_start_date FROM patient p "
            + " INNER JOIN encounter e ON p.patient_id = e.patient_id "
            + " INNER JOIN obs o ON e.encounter_id = o.encounter_id "
            + " WHERE p.voided = 0 AND e.voided = 0 AND o.voided = 0 AND e.encounter_type = 53 "
            + " AND o.concept_id = 1190 AND o.value_datetime is NOT NULL AND DATE(o.value_datetime) <= :endInclusionDate AND e.location_id = :location "
            + " GROUP BY p.patient_id  "
            + " ) art_start "
            + " GROUP BY patient_id  "
            + " ) tx_new "
            + " INNER JOIN "
            + " ( "
            + " SELECT p.patient_id, cc.encounter_datetime as encounter_datetime "
            + " FROM patient p "
            + " INNER JOIN encounter cc ON p.patient_id = cc.patient_id "
            + " INNER JOIN obs o ON cc.encounter_id = o.encounter_id "
            + " WHERE cc.voided = 0 AND cc.encounter_type = 6  AND cc.location_id = :location "
            + " AND o.concept_id = 23722 AND o.value_coded = 856 AND o.voided = 0 "
            + " ) fisrtConsultation ON fisrtConsultation.patient_id = tx_new.patient_id "
            + " WHERE fisrtConsultation.encounter_datetime BETWEEN date_add(tx_new.art_start_date, INTERVAL 80 DAY) AND date_add(tx_new.art_start_date, INTERVAL 130 DAY) "
            + " GROUP BY tx_new.patient_id  "
            + " ) AS B3 "
            + " INNER JOIN encounter e ON e.patient_id = B3.patient_id AND e.voided = 0 AND e.encounter_type = 53 AND e.location_id = :location "
            + " INNER JOIN obs o ON o.encounter_id = e.encounter_id AND o.voided = 0 "
            + " WHERE o.concept_id = 856 AND o.value_numeric IS NOT NULL AND "
            + " DATE(o.obs_datetime) >= DATE(B3.encounter_datetime) AND DATE(o.obs_datetime) <= date_add(DATE(B3.encounter_datetime), INTERVAL 33 DAY) ";

    public static final String findAllPatientsWhoArePregantsWithResultAfter33DaysRequestedCVByN =
        " SELECT B4.patient_id FROM "
            + " (SELECT fisrtConsultation.patient_id, fisrtConsultation.encounter_datetime "
            + " FROM  "
            + " ( "
            + " SELECT 	p.patient_id, min(cc.encounter_datetime) as encounter_datetime "
            + " FROM patient p "
            + " INNER JOIN encounter cc ON p.patient_id = cc.patient_id "
            + " INNER JOIN obs o ON cc.encounter_id = o.encounter_id "
            + " WHERE cc.voided = 0 AND cc.encounter_type = 6  AND cc.location_id = :location "
            + " AND DATE(cc.encounter_datetime) BETWEEN :startInclusionDate AND :endInclusionDate "
            + " AND o.concept_id = 1982 AND o.value_coded = 1065 AND o.voided = 0 "
            + " GROUP BY p.patient_id "
            + " ) fisrtConsultation "
            + " INNER JOIN obs cv ON cv.person_id = fisrtConsultation.patient_id "
            + " WHERE cv.concept_id = 23722 AND cv.value_coded = 856 AND cv.voided = 0 "
            + " ) AS B4 "
            + " INNER JOIN encounter e ON e.patient_id = B4.patient_id AND e.voided = 0 AND e.encounter_type = 53 AND e.location_id = :location "
            + " INNER JOIN obs o ON o.encounter_id = e.encounter_id AND o.voided = 0 "
            + " WHERE o.concept_id = 856 AND o.value_numeric IS NOT NULL AND "
            + " o.obs_datetime >= B4.encounter_datetime AND o.obs_datetime <= date_add(B4.encounter_datetime, INTERVAL 33 DAY) ";

    public static final String
        findAllPatientsWhoDroppedOutARTInFirstThreeMonthsAfterInitiatedTreatment =
            " SELECT tx_new.patient_id FROM ( "
                + " SELECT patient_id, MIN(art_start_date) art_start_date FROM ( "
                + " SELECT p.patient_id, MIN(value_datetime) art_start_date FROM patient p "
                + " INNER JOIN encounter e ON p.patient_id = e.patient_id "
                + " INNER JOIN obs o ON e.encounter_id = o.encounter_id "
                + " WHERE p.voided = 0 AND e.voided = 0 AND o.voided = 0 AND e.encounter_type = 53 "
                + " AND o.concept_id = 1190 AND o.value_datetime is NOT NULL AND o.value_datetime <= :endInclusionDate AND e.location_id = :location "
                + " GROUP BY p.patient_id "
                + " ) art_start "
                + " GROUP BY patient_id "
                + " ) tx_new "
                + "  inner join "
                + " ( "
                + "select p.patient_id, max(o.obs_datetime) data_estado from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs  o on e.encounter_id=o.encounter_id "
                + "where e.voided=0 and o.voided=0 and p.voided=0 and  e.encounter_type in (53,6) and o.concept_id in (6272,6273) and o.value_coded in (1707,1705) and e.location_id=:location "
                + "group by p.patient_id "
                + " ) abandono on abandono.patient_id = tx_new.patient_id "
                + "where tx_new.art_start_date BETWEEN :startInclusionDate AND :endInclusionDate and "
                + "abandono.data_estado between tx_new.art_start_date and date_add(tx_new.art_start_date, interval 3 MONTH) "
                + "group by tx_new.patient_id ";

    public static final String
        findAllPatientsWhoDroppedOutARTInFirstThreeMonthsBeforeInitiatedTreatment =
            " SELECT tx_new.patient_id FROM ( "
                + " SELECT patient_id, MIN(art_start_date) art_start_date FROM ( "
                + " SELECT p.patient_id, MIN(value_datetime) art_start_date FROM patient p "
                + " INNER JOIN encounter e ON p.patient_id = e.patient_id "
                + " INNER JOIN obs o ON e.encounter_id = o.encounter_id "
                + " WHERE p.voided = 0 AND e.voided = 0 AND o.voided = 0 AND e.encounter_type = 53 "
                + " AND o.concept_id = 1190 AND o.value_datetime is NOT NULL AND o.value_datetime <= :endInclusionDate AND e.location_id = :location "
                + " GROUP BY p.patient_id "
                + " ) art_start "
                + " GROUP BY patient_id "
                + " ) tx_new "
                + "  inner join "
                + " ( "
                + "select p.patient_id, max(o.obs_datetime) data_estado from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs  o on e.encounter_id=o.encounter_id "
                + "where e.voided=0 and o.voided=0 and p.voided=0 and  e.encounter_type in (53,6) and o.concept_id in (6272,6273) and o.value_coded in (1707,1705) and e.location_id=:location "
                + "group by p.patient_id "
                + " ) abandono on abandono.patient_id = tx_new.patient_id "
                + "where tx_new.art_start_date BETWEEN :startInclusionDate AND :endInclusionDate and "
                + "abandono.data_estado between date_sub(tx_new.art_start_date, interval 3 MONTH) and  tx_new.art_start_date  "
                + "group by tx_new.patient_id ";

    public static final String
        findAllPatientsWhoDroppedOutARTInFirstSixMonthsBeforeInitiatedTreatment =
            "select ultimaConsulta.patient_id from "
                + "( select p.patient_id, max(e.encounter_datetime) encounter_datetime from patient p   "
                + "inner join encounter e on p.patient_id=e.patient_id  "
                + "where e.voided=0  "
                + "and p.voided=0  "
                + "and  e.encounter_type = 6  "
                + "and e.location_id=:location "
                + "and e.encounter_datetime BETWEEN :startInclusionDate AND :endInclusionDate  "
                + "GROUP by p.patient_id "
                + ")ultimaConsulta "
                + "inner join "
                + "(select p.patient_id,o.obs_datetime data_estado from patient p  "
                + "inner join encounter e on p.patient_id=e.patient_id  "
                + "inner join obs  o on e.encounter_id=o.encounter_id  "
                + "where e.voided=0  "
                + "and o.voided=0  "
                + "and p.voided=0  "
                + "and  e.encounter_type in (53,6)  "
                + "and o.concept_id in (6272,6273)  "
                + "and o.value_coded in (1707,1705)  "
                + "and e.location_id=:location "
                + ") abandonoReenicio on ultimaConsulta.patient_id=abandonoReenicio.patient_id "
                + "where abandonoReenicio.data_estado between date_sub(ultimaConsulta.encounter_datetime, interval 6 MONTH) and  ultimaConsulta.encounter_datetime  ";

    public static final String findPatientsWhoDroppedOutARTThreeMonthsBeforeLastConsultationPeriod =
        "Select maxEnc.patient_id from ( "
            + "Select p.patient_id,max(e.encounter_datetime) encounter_datetime from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and e.encounter_type=6 and "
            + "e.encounter_datetime >=:startInclusionDate and e.encounter_datetime<=:endRevisionDate  and e.location_id=:location "
            + "group by p.patient_id "
            + ")maxEnc "
            + "  inner join "
            + "( "
            + "select p.patient_id, o.obs_datetime data_estado from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs  o on e.encounter_id=o.encounter_id "
            + "where e.voided=0 and o.voided=0 and p.voided=0 and  e.encounter_type in (53,6) and o.concept_id in (6272,6273) and o.value_coded in (1707,1705) and e.location_id=:location "
            + " ) abandono on abandono.patient_id = maxEnc.patient_id "
            + "where abandono.data_estado BETWEEN date_sub(maxEnc.encounter_datetime, INTERVAL 3 month) AND maxEnc.encounter_datetime ";

    public static final String
        findPatientsWhoDroppedOutARTInFirstSixMonthsPreviousConsultationMarkedAsPregnant =
            "Select maxEnc.patient_id from ( "
                + "Select p.patient_id,max(e.encounter_datetime) encounter_datetime from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "where p.voided=0 and e.voided=0 and e.encounter_type=6 and "
                + "e.encounter_datetime >=:startInclusionDate and e.encounter_datetime<=:endRevisionDate  and e.location_id=:location "
                + "group by p.patient_id "
                + ")maxEnc "
                + "  inner join "
                + "( "
                + "select p.patient_id, max(o.obs_datetime) data_estado from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs  o on e.encounter_id=o.encounter_id "
                + "where e.voided=0 and o.voided=0 and p.voided=0 and  e.encounter_type in (53,6) and o.concept_id in (6272,6273) and o.value_coded in (1707,1705) and e.location_id=:location "
                + "group by p.patient_id "
                + " ) abandono on abandono.patient_id = maxEnc.patient_id "
                + "where abandono.data_estado BETWEEN date_sub(maxEnc.encounter_datetime, INTERVAL 6 month) AND maxEnc.encounter_datetime ";

    public static final String findPregnantPatientsWhoReceivedViralLoadResultInTheAvaliationPeriod =
        "select patient_id from ( "
            + "select e.patient_id,min(e.encounter_datetime) encounter_datetime from( "
            + " SELECT p.patient_id, e.encounter_datetime dataConsulta FROM "
            + " patient p "
            + " INNER JOIN encounter e ON e.patient_id = p.patient_id and p.voided = 0 and e.voided = 0 and e.encounter_type = 6 and e.location_id =:location "
            + " INNER JOIN obs o ON o.encounter_id = e.encounter_id and o.voided = 0 and o.concept_id = 1982 and o.value_coded = 1065 and o.location_id =:location "
            + " INNER JOIN person pe ON pe.person_id = e.patient_id and pe.gender = 'F' "
            + " WHERE e.encounter_datetime between :startInclusionDate and :endInclusionDate "
            + " GROUP by p.patient_id "
            + " ) pregnant "
            + " INNER JOIN encounter e ON e.patient_id = pregnant.patient_id AND e.voided = 0 AND e.encounter_type = 6 AND e.location_id =:location "
            + " INNER JOIN obs o ON o.encounter_id = e.encounter_id AND o.voided = 0 "
            + " WHERE e.encounter_datetime between :startInclusionDate AND :endInclusionDate "
            + " AND ((o.concept_id = 856 AND o.value_numeric IS NOT NULL) OR (o.concept_id = 1305 AND o.value_coded IS NOT NULL)) "
            + " group by  e.patient_id "
            + " )gravidaCV ";

    public static final String
        findPregnantPatientsWhoReceivedViralLoadResultInTheAvaliationPeriodAnd33DaysAfterRequestLaboratoryInvestigations =
            "select patient_id from ( "
                + "select resultado.patient_id,max(e.encounter_datetime) dataPedido from ( "
                + "select e.patient_id,min(e.encounter_datetime) dataResultado from( "
                + " SELECT p.patient_id, e.encounter_datetime dataConsulta FROM "
                + " patient p "
                + " INNER JOIN encounter e ON e.patient_id = p.patient_id and p.voided = 0 and e.voided = 0 and e.encounter_type = 6 and e.location_id =:location "
                + " INNER JOIN obs o ON o.encounter_id = e.encounter_id and o.voided = 0 and o.concept_id = 1982 and o.value_coded = 1065 and o.location_id =:location "
                + " INNER JOIN person pe ON pe.person_id = e.patient_id and pe.gender = 'F' "
                + " WHERE e.encounter_datetime between :startInclusionDate and :endInclusionDate "
                + " GROUP by p.patient_id "
                + " ) pregnant "
                + " INNER JOIN encounter e ON e.patient_id = pregnant.patient_id AND e.voided = 0 AND e.encounter_type = 6 AND e.location_id =:location "
                + " INNER JOIN obs o ON o.encounter_id = e.encounter_id AND o.voided = 0 "
                + " WHERE e.encounter_datetime between :startInclusionDate AND :endInclusionDate "
                + " AND ((o.concept_id = 856 AND o.value_numeric IS NOT NULL) OR (o.concept_id = 1305 AND o.value_coded IS NOT NULL)) "
                + " group by  e.patient_id "
                + " )resultado "
                + " INNER JOIN encounter e ON e.patient_id = resultado.patient_id AND e.voided = 0 AND e.encounter_type = 6 AND e.location_id =:location "
                + " INNER JOIN obs o ON o.encounter_id = e.encounter_id "
                + " WHERE  o.concept_id = 23722 AND o.value_coded = 856 AND o.voided = 0 "
                + " and e.encounter_datetime >= date_sub(resultado.dataResultado, INTERVAL 33 DAY) and e.encounter_datetime<resultado.dataResultado  "
                + " group by  e.patient_id "
                + ") final ";
  }
}
